(self.webpackChunkmp_webgl=self.webpackChunkmp_webgl||[]).push([[383],{20243:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>s});var n=a(66219),l=a(43993),i=a(2388),r=a(41659),o=a(86980);const s=async function(e){const t=await e.getModule(l.default),a=t.addPanel(n.s.TITLE,n.s.HOTKEYS,{width:350});await t.loadPromise.then((()=>{const n="meshtextures";[{panel:a,header:n,setting:"textureStreamPause",initialValue:()=>i.ZP.debugPauseTexStream,onChange:e=>{i.ZP.debugPauseTexStream=e},urlParam:!0},{panel:a,header:n,setting:"textureStreamRaycastHits",initialValue:()=>i.ZP.debugLOD,onChange:e=>{i.ZP.debugLOD=e,e||(0,o.d)()},urlParam:!0},{panel:a,header:n,setting:"debugRTTQuality",initialValue:()=>i.ZP.debugRttQuality,onChange:t=>{i.ZP.debugRttQuality=t,t||e.commandBinder.issueCommand(new r.u({color:null},{style:r.u.selectBy.all}))},urlParam:!0},{panel:a,header:n,setting:"debugRTTScores",initialValue:()=>i.ZP.debugRttScores,onChange:t=>{i.ZP.debugRttScores=t,t||e.commandBinder.issueCommand(new r.u({color:null},{style:r.u.selectBy.all}))},urlParam:!0}].forEach((e=>t.registerMenuEntry(e)))}))}},54088:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>C,tiledMeshDebugMenu:()=>M});var n=a(88512),l=a(43993),i=a(96909),r=a(10757),o=a(84933),s=a(55356),u=a(66219),d=a(59855),g=a(2388),c=a(84303),m=a(2212),h=a(6559),p=a(44283);function y(e,t=16){let a;const n=(0,p.k1)((()=>a=window.setInterval((()=>e()),t)),(()=>{a&&clearInterval(a)}));return n.cancel(),n}const b=new n.Z("tiled-mesh");let x,T=null;function v(e,t,a){T||(T=document.createElement("div"),T.style.color="#FFFFFF",T.style.fontFamily="Roboto",T.style.fontWeight="300",T.style.fontSize="12px",T.style.position="absolute",T.style.top="50px",T.style.width="500px",T.style.pointerEvents="none",T.style.whiteSpace="pre",T.style.zIndex="99999",T.style.textShadow="0 0 1px black, 0 0 1px black, 0 0 1px black, 0 0 1px black",document.body.appendChild(T));let n=d.t.statsTiles?function(e,t){const a=e.tilesRenderer,n=a.visibleTiles,l={};n.forEach((e=>{var t;const a=`lod${null===(t=e.extras)||void 0===t?void 0:t.level}`,n=l[a]||0;l[a]=n+1}));const i=t.threeRenderer.info,{stats:r,downloadQueue:o,parseQueue:s}=a,{active:u,downloading:d,inFrustum:g,parsing:c,used:m,visible:h}=r;return`\nthree:\n    drawCalls: ${i.render.calls}\n    geometries: ${i.memory.geometries}\n    textures: ${i.memory.textures}\n    triangles: ${i.render.triangles}\n    memory allocated (megs): ${Math.floor(t.estimatedGPUMemoryAllocated()/2**20)}\ntiles:\n    tiles in frustum: ${g}\n    visible: ${h}\n      lod0 tiles: ${l.lod0||0}\n      lod1 tiles: ${l.lod1||0}\n      lod2 tiles: ${l.lod2||0}\n      lod3 tiles: ${l.lod3||0}\n    downloading gltf: ${d}\n    parsing gltf: ${c}\n    active: ${u}\n    used: ${m}\n    queues:\n      download: ${o.currJobs} running, ${o.items.length} waiting\n      parse: ${s.currJobs} running, ${s.items.length} waiting\n`}(e,a):"";n+=d.t.statsTextureStream?function(e){const t="downloaded:\n"+Object.keys(e.totalTextures).map((t=>`    ${t}: ${e.totalTextures[t]} `)).join("\n")+"\n";return`textureStreaming:\n    downloadingTiles: ${e.downloadingTiles} / ${e.totalTiles}\n    downloadingTextures: ${e.loadingTextures}\n`+t}(t):"",n+=d.t.statsTextures?function(e){if(x)return x;const t=e.tilesRenderer;if(!t)return"";const a={};function n(e,t,a){const n=a.extras.maxTextureSize||0,l=e[t]||new Map;e[t]=l,l.set(n,(l.get(n)||new Set).add(a.extras.textureName))}return t.traverse((e=>{if(e.extras&&void 0!==e.extras.maxTextureSize&&void 0!==e.extras.level){const t=`lod${e.extras.level}`;n(a,t,e)}return!1}),(()=>!1)),x="texturesPerLod:\n"+Object.keys(a).map((e=>`    ${e}:${[...a[e].entries()].map((([e,t])=>` ${e}px: ${t.size}`))} `)).join("\n"),x}(e):"",T.textContent=n}async function M(e){const t=await e.getModule(l.default),a=await e.getModuleBySymbol(i.y.INPUT),n=await e.getModuleBySymbol(i.y.WEBGL_RENDERER),c=n.getScene(),m=await e.getModuleBySymbol(i.y.MODEL_MESH),p=m.modelTextureLoader,x=m.modelMesh.tileLoader,T=t.tryGetProperty(g.iT,!1);T&&d.t.statsTiles&&setInterval((()=>v(x,p,n)),150);const M=t.addPanel(u.s.TITLE,u.s.HOTKEYS,{width:350}),C={viz:"visualize",stats:"stats",tile:"tileset",log:"log"},P=function(e,t,a,n,l){const i=S(a,l,((e,t)=>e.setWireframe(t))),r=function(e,t){const a={scale:1},n=(t,n)=>{if(!t)return;const l=e.container.tilesByChunkId.get(t.id),i=(null==l?void 0:l.__error)||1e-4,r=3!==t.lod&&i>d.t.errorTarget?1:.5,o=Math.max(0,Math.min(1,1-a.scale/i)),s=n?f(t.lod,o,r):null;t.setColorOverlay(s)},l=S(e,t,n),i=y((()=>l.colorize(e.container.chunks)));return{toggle:e=>{e?i.renew():i.cancel(),l.toggle(e)},colorize:l.colorize,subscription:i,config:a}}(a,l),u=S(a,l,((e,t)=>{e.setColorOverlay(t?f(e.lod,1,.5):null)})),g=S(a,l,((e,t)=>{e.setColorOverlay(t?(0,s.G1)(.5,e.id||0):null)})),c=S(a,l,((e,t)=>{var n;const l=a.container.tilesByChunkId.get(e.id);e.setColorOverlay(t?(0,s.G1)(.5,(0,o.un)((null===(n=null==l?void 0:l.content)||void 0===n?void 0:n.uri)||"missing")||0):null)})),m=S(a,l,((e,t)=>{e.setColorOverlay(t?(0,s.G1)(.5,(e.meshGroup<<16)+e.meshSubgroup||0):null)})),p=S(a,l,((e,t)=>{e.setColorOverlay(t?(0,s.G1)(.5,e.meshSubgroup||0):null)})),x=S(a,l,((e,t)=>{e.setColorOverlay(t?(0,s.G1)(.5,e.meshGroup||0):null)})),T=S(a,l,((e,t)=>{e.setColorOverlay(t?(0,s.G1)(.5,(0,o.un)(e.textureName)||0):null)})),v=S(a,l,((e,t)=>{const n=a.container.tilesByChunkId.get(e.id);e.setColorOverlay(t?(0,s.G1)(.5,(null==n?void 0:n.geometricError)||0):null)})),M=n.slots,C=(0,h.qT)(),P=S(a,l,((e,t)=>{const a=M.find((t=>t.textureName===e.textureName));if(a){const n=a.loading?1:a.quality>C.min(e.lod)?.7:.3,l=C.maxTexelSize/C.get(a.quality).texelSize;e.setColorOverlay(t?f(e.lod,l,n):null)}})),w=y((()=>P.colorize(a.container.chunks)));let E="none";const O={none:void 0,byError:r,byGeometricError:v,byTile:c,bySubgroup:p,byMeshgroup:x,bySubAndMeshgroup:m,byTexture:T,byStreamedTextures:{subscription:w,toggle:e=>{e?w.renew():w.cancel(),e&&b.info("colorize=byStreamedTextures solid color: loading, dark color: streamed, light color: basis"),P.toggle(e)}},byChunk:g,byLod:u};return[{panel:e,header:t.viz,setting:"disableTileUpdates",initialValue:()=>d.t.disableTileUpdates,onChange:e=>{d.t.disableTileUpdates=e},urlParam:!0},{panel:e,header:t.viz,setting:"wireframe",initialValue:()=>!1,onChange:i.toggle,urlParam:!0},{panel:e,header:t.viz,setting:"colorize",initialValue:()=>"none",onChange:e=>{var t,a;null===(t=O[E])||void 0===t||t.toggle(!1),null===(a=O[e])||void 0===a||a.toggle(!0),E=e},options:Object.keys(O),urlParam:!0},{panel:e,header:t.viz,setting:"colorizeByErrorScale",initialValue:()=>1,onChange:e=>{r.config.scale=e},range:[0,6],rangePrecision:3,urlParam:!0}]}(M,C,x,p,e),w=[{panel:M,header:C.stats,setting:"tileStatsOverlay",initialValue:()=>d.t.statsTiles,onChange:e=>{d.t.statsTiles=e},urlParam:!0},{panel:M,header:C.stats,setting:"textureStatsOverlay",initialValue:()=>d.t.statsTextures,onChange:e=>{d.t.statsTextures=e},urlParam:!0},{panel:M,header:C.stats,setting:"textureStreamingOverlay",initialValue:()=>d.t.statsTextureStream,onChange:e=>{d.t.statsTextureStream=e},urlParam:!0}],E=[{panel:M,header:C.log,buttonName:"Log: App State",callback:()=>{b.warn(m),b.warn(a),b.warn(c),b.warn(t)}}];T&&(d.t.hideMenu||await(0,r.gw)(1e3).then((()=>{t.getSettingsGui().loadGuiPackage().then((()=>{t.getSettingsGui().toggle(t.getMainPanelId()),t.getSettingsGui().toggle(t.getMainPanelId())}))})),await(0,r.gw)(16),P.forEach((e=>t.registerMenuEntry(e))),await(0,r.gw)(16),function(e,t){return[{panel:e,header:t.tile,setting:"maxDepth",initialValue:()=>d.t.maxDepth,onChange:e=>{d.t.maxDepth=e},range:[0,6],rangePrecision:0,urlParam:!0},{panel:e,header:t.tile,setting:"errorTarget",initialValue:()=>d.t.errorTarget,onChange:e=>{d.t.errorTarget=e},range:[0,20],rangePrecision:1,urlParam:!0},{panel:e,header:t.tile,setting:"displayActiveTiles",initialValue:()=>d.t.displayActiveTiles,onChange:e=>{d.t.displayActiveTiles=e},urlParam:!0},{panel:e,header:t.tile,setting:"loadSiblings",initialValue:()=>d.t.loadSiblings,onChange:e=>{d.t.loadSiblings=e},urlParam:!0},{panel:e,header:t.tile,setting:"autoDisableRendererCulling",initialValue:()=>d.t.autoDisableRendererCulling,onChange:e=>{d.t.autoDisableRendererCulling=e},urlParam:!0},{panel:e,header:t.tile,setting:"stopAtEmptyTiles",initialValue:()=>d.t.stopAtEmptyTiles,onChange:e=>{d.t.stopAtEmptyTiles=e},urlParam:!0},{panel:e,header:t.tile,setting:"disableTileUpdates",initialValue:()=>d.t.disableTileUpdates,onChange:e=>{d.t.disableTileUpdates=e},urlParam:!0},{panel:e,header:t.tile,setting:"useOcclusionInfo",initialValue:()=>d.t.useOcclusionInfo,onChange:e=>{d.t.useOcclusionInfo=e},urlParam:!0},{panel:e,header:t.tile,setting:"disposeModel",initialValue:()=>d.t.disposeModel,onChange:e=>{d.t.disposeModel=e},urlParam:!0},{panel:e,header:t.tile,setting:"allocatedMegsBeforeLimitingLod",initialValue:()=>d.t.allocatedMegsBeforeLimitingLod,onChange:e=>{d.t.allocatedMegsBeforeLimitingLod=e},urlParam:!0,range:[100,1e3]},{panel:e,header:t.tile,setting:"fixedMobileBudget",initialValue:()=>d.t.fixedMobileBudget,onChange:e=>{d.t.fixedMobileBudget=e},urlParam:!0,range:[0,200]},{panel:e,header:t.tile,setting:"lruMinSize",initialValue:()=>d.t.lruMinSize,onChange:e=>{d.t.lruMinSize=e},urlParam:!0,range:[0,2e3]},{panel:e,header:t.tile,setting:"lruMaxSize",initialValue:()=>d.t.lruMaxSize,onChange:e=>{d.t.lruMaxSize=e},urlParam:!0,range:[0,2e3]},{panel:e,header:t.tile,setting:"lruUnloadPercent",initialValue:()=>d.t.lruUnloadPercent,onChange:e=>{d.t.lruUnloadPercent=e},urlParam:!0,range:[0,1]}]}(M,C).forEach((e=>t.registerMenuEntry(e))),w.forEach((e=>t.registerMenuEntry(e))),E.forEach((e=>t.registerMenuButton(e))))}function S(e,t,a){let n=!1;const l=e=>{t.after(c.A.End).then((()=>{e.forEach((e=>{e&&a(e,n)}))}))},i=e.notifyOnChunksLoaded(l);i.cancel();return{toggle:t=>{t?i.renew():i.cancel(),t!==n&&(n=t,l([...e.container.chunks]))},colorize:l,subscription:i}}function f(e,t,a){const n=0===e||3===e?1:0,l=1===e||3===e?1:0,i=2===e||3===e?1:0;return new m.Vector4(n*t,l*t,i*t,a)}const C=M},66219:(e,t,a)=>{"use strict";a.d(t,{s:()=>n});const n={TITLE:"streamed-mesh (T)",HOTKEYS:[a(81507).R.T]}},41659:(e,t,a)=>{"use strict";a.d(t,{u:()=>SetMeshOverlayCommand});var n,l,i=a(17386);!function(e){e.all="all",e.byFloorId="byFloorId",e.byRoomId="byRoomId",e.byMeshGroup="byMeshGroup",e.byMeshSubGroup="byMeshSubGroup"}(n||(n={})),function(e){e.explicit="explicit",e.random="random"}(l||(l={}));class SetMeshOverlayCommand extends i.m{constructor(e,t){super(),this.id="SET_MESH_OVERLAY_COLOR",this.payload={selectBy:(null==t?void 0:t.style)||n.all,colorStyle:(null==e?void 0:e.style)||l.explicit,color:(null==e?void 0:e.color)||null,alpha:(null==e?void 0:e.alpha)||.5,id:null==t?void 0:t.id,index:null==t?void 0:t.index}}}SetMeshOverlayCommand.selectBy=n,SetMeshOverlayCommand.colorBy=l,SetMeshOverlayCommand.COLOR_DIM={x:0,y:0,z:0,w:.3}},59855:(e,t,a)=>{"use strict";a.d(t,{t:()=>i});var n=a(17597),l=a(20331);const i={urlTemplateToken:"<file>",hideMenu:"1"!==(0,n.eY)("dmenu","0"),debug:"1"===(0,n.eY)("debugTiles","0"),displayBoxBounds:!1,initialMaxDepth:0,maxDepth:Number((0,n.eY)("maxDepth","10")),loadSiblings:!0,displayActiveTiles:!1,autoDisableRendererCulling:!0,optimizeRaycast:!1,stopAtEmptyTiles:!1,statsTiles:!0,statsTextures:!1,statsTextureStream:!1,errorTarget:Number((0,n.eY)("errorTarget",4)),disableTileUpdates:!1,useOcclusionInfo:!0,disposeModel:!1,allocatedMegsBeforeLimitingLod:300,lruMinSize:0,lruMaxSize:800,lruUnloadPercent:.5,fixedMobileBudget:12,tileAssetRequestPriority:l.RequestPriority.MEDIUM,downloadQueueConcurrency:8,parseQueueConcurrency:10}},86980:(e,t,a)=>{"use strict";a.d(t,{e:()=>s,d:()=>u});var n=a(2212);const l=a(2388).ZP.sightingMaxAge,i=new n.Color;let r,o=-1;const s=(e,t)=>{r||(r=new n.InstancedMesh(new n.SphereBufferGeometry(.005,8,4),new n.MeshBasicMaterial,l),d(r));const a=new n.Matrix4;return({point:n,distance:s})=>{a.makeScale(s,s,s).setPosition(n),r.setMatrixAt(++o%l,a),r.instanceMatrix.needsUpdate=!0;for(let t=l;t--;)r.setColorAt((o-t+l)%l,i.set(e).multiplyScalar(1-t/l));r.instanceColor&&(r.instanceColor.needsUpdate=!0),r.parent||t.scene.add(r)}},u=()=>{var e;r&&(null===(e=r.parent)||void 0===e||e.remove(r),d(r))};function d(e){const t=(new n.Matrix4).makeScale(0,0,0);for(let a=0;a<l;a++)e.setMatrixAt(a,t)}}}]);